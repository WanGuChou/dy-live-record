# 🎬 抖音直播监控快速开始

## 🎯 功能简介

CDP Monitor 现在支持**自动解析抖音直播WebSocket消息**！

当你打开抖音直播间时，服务器会自动识别并解析所有直播消息，包括：
- 💬 聊天消息
- 🎁 礼物消息
- ❤️ 点赞消息
- 👤 用户进入
- 👥 在线人数
- ⭐ 关注消息

---

## 🚀 快速开始（5分钟）

### 步骤1: 启动服务器

```bash
cd server
npm install  # 首次运行
npm start
```

**看到这个说明启动成功：**
```
================================================================================
CDP Monitor 服务器已启动
地址: ws://localhost:8080/monitor
================================================================================

监控内容:
  ✅ 所有 HTTP/HTTPS 请求 (使用 Chrome DevTools Protocol)
  ✅ WebSocket 连接创建
  ✅ WebSocket 握手过程
  ✅ WebSocket 发送的所有消息
  ✅ WebSocket 接收的所有消息
  ✅ WebSocket 连接关闭
  🎬 抖音直播消息自动解析  ← 新功能！
```

---

### 步骤2: 启动Chrome（隐藏调试横幅）

**Windows:**
```cmd
cd dy-live-record\brower-monitor
.\START_CHROME_SIMPLE.bat
```

**macOS/Linux:**
```bash
cd dy-live-record/brower-monitor
./start-chrome.sh
```

---

### 步骤3: 安装插件

1. 在Chrome中打开：`chrome://extensions/`
2. 启用"开发者模式"
3. 点击"加载已解压的扩展程序"
4. 选择 `dy-live-record/brower-monitor` 文件夹

---

### 步骤4: 配置插件

1. 点击插件图标
2. 服务器地址：`ws://localhost:8080/monitor`
3. 过滤关键字：留空（监控所有）
4. 打开"启用监控"
5. 点击"保存配置"

---

### 步骤5: 打开抖音直播

访问任意抖音直播间，例如：
```
https://live.douyin.com/xxxx
```

---

## 🎉 查看效果

服务器终端会自动显示解析后的直播消息！

### WebSocket连接建立

```
╔══════════════════════════════════════════════════════════════════════════════╗
║ 🔌 WebSocket 创建 #1 [抖音直播]
╠══════════════════════════════════════════════════════════════════════════════╣
║ 完整URL: wss://webcast100-ws-web-hl.douyin.com/webcast/im/push/v2/...
║ 标签页ID: 123
║ 请求ID: 456.1
║ ⭐ 抖音直播WebSocket，将自动解析消息内容
║ 时间: 2025-11-15T16:00:00.000Z
╚══════════════════════════════════════════════════════════════════════════════╝
```

### 聊天消息

```
╔══════════════════════════════════════════════════════════════════════════════╗
║ 🎬 抖音直播消息
╠══════════════════════════════════════════════════════════════════════════════╣
║ 消息类型: 聊天消息
║ 时间: 2025-11-15T16:00:01.000Z
║ 用户: 张三 [Lv.15]
║ 内容: 主播666！
║ 徽章: 粉丝团, VIP
╚══════════════════════════════════════════════════════════════════════════════╝
```

### 礼物消息

```
╔══════════════════════════════════════════════════════════════════════════════╗
║ 🎬 抖音直播消息
╠══════════════════════════════════════════════════════════════════════════════╣
║ 消息类型: 礼物消息
║ 时间: 2025-11-15T16:00:02.000Z
║ 用户: 李四
║ 礼物: 玫瑰花 x 10
║ 价值: 100 💎
║ 连击: 5
╚══════════════════════════════════════════════════════════════════════════════╝
```

### 统计信息（每50条消息）

```
╔══════════════════════════════════════════════════════════════════════════════╗
║ 📊 统计信息
╠══════════════════════════════════════════════════════════════════════════════╣
║ 总消息数: 100
║ HTTP请求数: 50
║ WebSocket连接数: 1
║ 抖音直播消息: 50
╚══════════════════════════════════════════════════════════════════════════════╝

╔══════════════════════════════════════════════════════════════════════════════╗
║ 📊 抖音直播统计
╠══════════════════════════════════════════════════════════════════════════════╣
║ 总消息数: 50
║ 聊天消息: 30
║ 礼物消息: 10
║ 点赞消息: 8
║ 进入直播间: 2
║ 当前在线: 1234 👥
║ 更新时间: 2025-11-15T16:00:00.000Z
╚══════════════════════════════════════════════════════════════════════════════╝
```

---

## 📊 支持的消息类型

| 类型 | 说明 | 包含信息 |
|------|------|---------|
| 💬 聊天消息 | 用户发送的弹幕 | 用户名、等级、内容、徽章 |
| 🎁 礼物消息 | 用户送的礼物 | 用户名、礼物名称、数量、价值、连击 |
| ❤️ 点赞消息 | 用户点赞 | 用户名、点赞数 |
| 👤 进入直播间 | 用户进入 | 用户名、等级、当前人数 |
| 👥 在线人数 | 人数更新 | 在线人数 |
| ⭐ 关注消息 | 用户关注 | 用户名、动作 |

---

## 🔍 实际使用场景

### 场景1: 监控热门直播间

```bash
# 1. 启动服务器
npm start

# 2. 启动Chrome + 插件
# 3. 打开热门直播间
# 4. 实时查看所有弹幕、礼物、互动数据
```

### 场景2: 分析直播数据

服务器会自动统计：
- 聊天消息数量
- 礼物总数和价值
- 点赞数
- 进入人数
- 实时在线人数

### 场景3: 直播间互动分析

可以看到：
- 谁发送了什么消息
- 谁送了什么礼物
- 实时在线人数变化
- 用户等级和徽章信息

---

## 💡 进阶使用

### 使用过滤关键字

只监控抖音直播消息：

1. 打开插件配置
2. 过滤关键字输入：`webcast,douyin`
3. 保存配置

**效果**：只有抖音直播相关的请求会被发送到服务器

### 监控多个直播间

1. 打开多个标签页
2. 每个标签页打开不同的直播间
3. 服务器会显示所有直播间的消息
4. 通过标签页ID区分不同直播间

---

## 🐛 故障排查

### Q1: 没有看到抖音直播消息

**检查：**
1. 确认访问的是抖音直播间（live.douyin.com）
2. 查看服务器是否显示"抖音直播WebSocket"
3. 确认插件监控已启用
4. 查看Service Worker日志

### Q2: 消息没有被解析

**可能原因：**
1. 抖音使用了Protobuf格式（部分直播间）
2. 消息格式有变化

**查看原始消息：**
- 服务器会显示原始WebSocket消息
- 查看是否有JSON格式的内容

### Q3: 统计信息不准确

**原因：**
- 某些消息类型未被识别
- 可能需要更新解析器

**解决：**
- 查看服务器日志中的"未知消息类型"
- 提交Issue反馈

---

## 📚 详细文档

- **抖音解析详细说明**: [server/README_DOUYIN.md](server/README_DOUYIN.md)
- **CDP使用指南**: [CDP_USAGE.md](CDP_USAGE.md)
- **完整测试指南**: [CDP_TEST.md](CDP_TEST.md)
- **主文档**: [README.md](README.md)

---

## 🎓 技术原理

### 工作流程

```
抖音直播间
    ↓
浏览器建立WebSocket连接
    ↓
CDP Monitor 捕获所有WebSocket消息
    ↓
发送到服务器
    ↓
dy_ws_msg.js 自动检测和解析
    ↓
格式化输出到终端
```

### 检测逻辑

```javascript
// URL包含这些关键词就是抖音直播
url.includes('webcast') && url.includes('douyin.com')
```

### 消息格式

抖音直播主要使用两种格式：
1. **JSON格式**（大部分）- 当前支持
2. **Protobuf格式**（部分）- 简单支持

---

## 🔮 未来功能

计划支持：
- [ ] 完整的Protobuf解析
- [ ] 礼物价值统计（总收入）
- [ ] 高频用户排行榜
- [ ] 消息导出（CSV/JSON）
- [ ] Web可视化界面
- [ ] 实时数据图表

---

## ✅ 总结

现在你可以：

1. ✅ 监控抖音直播间的所有WebSocket消息
2. ✅ 自动解析聊天、礼物、点赞等消息
3. ✅ 查看美化的消息输出
4. ✅ 获取实时统计数据
5. ✅ 分析直播间互动情况

**开始监控抖音直播只需5分钟！** 🚀

---

**更新时间**: 2025-11-15  
**版本**: v2.0.0  
**支持平台**: 抖音直播（Web版）
