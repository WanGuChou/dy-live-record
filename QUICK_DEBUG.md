# 🚀 快速调试参考

## 问题：浏览器有WebSocket连接但服务器没反应

### ⚡ 快速检查清单（5分钟）

```bash
# 1. 启动服务器
cd server && npm start

# 2. 测试服务器（新终端）
cd server && node test-connection.js
```

```
# 3. 检查浏览器插件配置
地址: ws://localhost:8080/monitor  ✅ (必须是 ws:// 不是 wss://)
启用监控: 开关打开（蓝色）     ✅
连接状态: 绿色 "已连接"        ✅
```

---

## 🔍 查看详细日志

### 浏览器插件日志

**Chrome**: `chrome://extensions/` → 点击 "Service Worker"  
**Edge**: `edge://extensions/` → 点击 "检查视图"

**应该看到：**
```
[时间] [URL Monitor] ✅ WebSocket连接成功建立！
[时间] [URL Monitor] ✅ 消息发送成功
```

**如果看到错误：**
```
[时间] [URL Monitor] ❌ WebSocket错误
```
→ 说明服务器未启动或地址错误

---

### 服务器日志

**应该看到：**
```
============================================================
[时间] 🎉 新客户端已连接
============================================================
客户端信息:
  - IP地址: ::1
  - 当前总连接数: 1
```

**如果没有这条日志：**
- ❌ 服务器未收到连接
- 检查插件配置地址是否正确
- 运行测试脚本验证服务器工作

---

## 🐛 常见问题速查

| 症状 | 原因 | 解决 |
|------|------|------|
| 插件显示"连接中..." | 服务器未启动 | `cd server && npm start` |
| 插件显示"❌ 错误" | 地址错误 | 确认是 `ws://localhost:8080/monitor` |
| 服务器无反应 | 监控未启用 | 打开"启用监控"开关 |
| 连接成功但无消息 | 监控开关关闭 | 确认开关是蓝色（已打开）|

---

## 🎯 完整调试流程

```
1. 启动服务器
   cd server && npm start
   ↓ 看到 "✅ WebSocket服务器已成功启动"
   
2. 测试服务器
   node test-connection.js
   ↓ 看到 "✅ 测试成功"
   
3. 配置插件
   地址: ws://localhost:8080/monitor
   ↓ 点击 "测试连接"
   ↓ 看到 "连接测试成功"
   
4. 启用监控
   打开 "启用监控" 开关
   ↓ 状态变为绿色 "已连接"
   
5. 查看日志
   浏览器: chrome://extensions/ → Service Worker
   服务器: 终端输出
   ↓ 两边都看到连接成功的消息
   
6. 测试功能
   打开新标签页访问网站
   ↓ 服务器收到 url_change 消息
   
✅ 完成！
```

---

## 📚 详细文档

需要更多帮助？查看：

- **完整调试指南**: [DEBUG_GUIDE.md](./DEBUG_GUIDE.md)
- **故障排查**: [TROUBLESHOOTING.md](./TROUBLESHOOTING.md)
- **项目文档**: [README.md](./README.md)

---

## 💡 关键提示

1. ⚠️ **必须是 `ws://` 不是 `wss://`** (本地开发)
2. ⚠️ **必须包含路径 `/monitor`**
3. ⚠️ **"启用监控" 开关必须打开**
4. ✅ **同时查看浏览器和服务器日志**
5. ✅ **先运行测试脚本验证服务器**

---

**最后更新**: 2025-11-15
